<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Test Stateful Editing</title>
		<meta name="viewport" content="width=570">
		<style>
			@import "../../dojo/resources/dojo.css";
			@import "../../dijit/themes/claro/claro.css";
			@import "../css/skins/claro.css";
		</style>
		<script src="../../dojo/dojo.js" 
			data-dojo-config="async: true, isDebug: true"></script>
		<script>
		require([
			"dojo/_base/declare",
			"dojo/store/Memory",
			"dijit/_WidgetBase",
			"dgrid/OnDemandGrid",
			"dgrid/editor",
			"dgrid/test/data/base"
		], function (declare, Memory, _WidgetBase, OnDemandGrid, editor) {
			var State = declare(_WidgetBase, {
					_setAbbreviationAttr: function (abbreviation) {
						console.log("abbreviation updating from", this.abbreviation, "to", abbreviation);
						this.abbreviation = abbreviation;
					},
					_setNameAttr: function (name) {
						console.log("name updating from", this.name, "to", name);
						this.name = name;
					}
				});

			function createStore() {
				var data = [],
					states = testStateStore.data,
					state, i, total;

				for (i = 0, total = states.length; i < total; i++) {
					state = states[i];

					data.push(
						new State({
							abbreviation: state.abbreviation,
							name: state.name
						})
					);
				}

				return new Memory({
					data: data,
					idProperty: "abbreviation"
				});
			}

			window.grid = new OnDemandGrid({
				store: createStore(),
				columns: [
					editor({
						label: "Abbreviation",
						field: "abbreviation",
						editor: "text",
						editOn: "dblclick"
					}),
					editor({
						label: "Name",
						field: "name",
						editor: "text",
						editOn: "dblclick"
					})
				]
			}, "grid");

			grid.startup();
		});
		</script>
	</head>
	<body class="claro">
		<h2>Editor with Stateful objects</h2>
		(This test requires dojo and dijit to be installed)
		<div id="grid"></div>
		<button type="button" id="save" onclick="grid.save()">Save</button>
	</body>
</html>